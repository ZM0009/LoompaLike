<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Loompa-Like</title>
  
  <style>
    :root{
      --bg:#180824;            /* deep candy-plum */
      --bg2:#2a0f40;
      --card:#240a34;
      --muted:#ffd9ff;         /* soft cotton-candy text */
      --text:#fff7ff;          /* warm white */
      --accent:#7c3aed;        /* grape taffy */
      --accent2:#ff7ac6;       /* bubblegum pink */
      --good:#50fa7b;          /* lime jelly */
      --bad:#ff5555;           /* cinnamon red */
      --warn:#ffd166;          /* butterscotch */
      --gold:#f3c96b;          /* golden ticket */
      --choco:#4e2a14;         /* chocolate */
    }
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    html,body{height:100%}
    body{
      margin:0;
      font-family:ui-rounded, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 10% -10%, rgba(255,174,255,0.18), transparent 60%),
        radial-gradient(1200px 800px at 110% 110%, rgba(255,219,140,0.16), transparent 60%),
        linear-gradient(135deg, var(--bg), var(--bg2));
      -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
    }

    /* Candy cane stripe border utility */
    
.candy-border{
  position:relative;
  border-radius:28px;
  padding:1px;
  background:#0d1230; /* dark navy background instead of candy stripes */
  box-shadow:0 16px 40px rgba(0,0,0,0.35);
}
.candy-border > .card-inner{
  background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
  border:1px solid rgba(255,255,255,0.12);
  border-radius:26px;
  padding:20px;
  backdrop-filter: blur(8px);
}


    .wrap{min-height:100dvh;display:flex;align-items:center;justify-content:center;padding:24px}
    .app{width:min(100%,1100px);}

    h1,h2,h3{margin:0 0 12px}
    h1{
      font-size:clamp(26px,5vw,44px);
      letter-spacing:0.5px;
      color:var(--gold);
      text-shadow:0 2px 0 rgba(0,0,0,0.25), 0 0 18px rgba(243,201,107,0.35);
    }
    h2{color:#ffe8ff}

    .row{display:flex;gap:16px;flex-wrap:wrap}
    .grid{display:grid;gap:10px}

    /* Buttons = candy gems */
    .btn{
      appearance:none;border:none;
      background:
        linear-gradient(180deg, rgba(255,255,255,0.35), rgba(255,255,255,0) 40%),
        linear-gradient(135deg,var(--accent),var(--accent2));
      color:white;padding:14px 18px;border-radius:16px;font-weight:800;cursor:pointer;
      box-shadow:0 8px 18px rgba(124,58,237,0.35), inset 0 -6px 10px rgba(0,0,0,0.15);
      transition:transform .06s ease, filter .2s, opacity .2s;
      touch-action:manipulation;
    }
    .btn:active{transform:translateY(1px)}
    .btn.secondary{
      background:
        linear-gradient(180deg, rgba(255,255,255,0.15), rgba(255,255,255,0) 40%),
        linear-gradient(135deg,#5b2a9a,#3b1b6e);
      border:1px solid rgba(255,255,255,0.22);
      box-shadow:0 8px 16px rgba(25, 3, 65, 0.35), inset 0 -6px 10px rgba(0,0,0,0.15);
    }
    .btn.good{background:
      linear-gradient(180deg, rgba(255,255,255,0.35), rgba(255,255,255,0) 40%),
      linear-gradient(135deg,#34d399,#10b981)}
    .btn.warn{background:
      linear-gradient(180deg, rgba(255,255,255,0.35), rgba(255,255,255,0) 40%),
      linear-gradient(135deg,#ffd166,#f59e0b)}
    .btn.bad{background:
      linear-gradient(180deg, rgba(255,255,255,0.35), rgba(255,255,255,0) 40%),
      linear-gradient(135deg,#ff7676,#e11d48)}

    .muted{color:var(--muted)}

    .field{display:grid;gap:6px}
    label{font-size:14px;color:#ffe3ff}
    input[type="text"], select{
      width:100%;padding:14px 12px;border-radius:14px;
      border:1px solid rgba(255,255,255,0.18);
      background:linear-gradient(180deg, #3b174f, #2a113d);
      color:var(--text);font-size:16px;
      box-shadow:inset 0 2px 10px rgba(0,0,0,0.25);
    }

    .players{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:14px}

    /* Golden ticket player cards */
    .playerBadge{
      padding:0;border-radius:18px;background:transparent;border:none;
    }
    .ticket{
      position:relative;border-radius:18px;padding:16px;
      background:
        radial-gradient(200% 140% at 0% 0%, rgba(255,255,255,0.35), rgba(255,255,255,0) 40%),
        linear-gradient(135deg, #7a5615, #f3c96b 35%, #7a5615 70%, #f3c96b);
      color:#3b2405;
      border:1px solid rgba(255,255,255,0.25);
      box-shadow:0 8px 20px rgba(0,0,0,0.35);
    }
    .ticket .nameBtn{
      background:
        linear-gradient(180deg, rgba(255,255,255,0.45), rgba(255,255,255,0) 40%),
        linear-gradient(135deg, #f7de95, #e4b851);
      color:#3b2405;
      border:1px solid rgba(74,46,5,0.35);
      box-shadow:inset 0 -6px 10px rgba(0,0,0,0.1);
    }
    .nameBtn{padding:18px;border-radius:14px;font-weight:900;font-size:clamp(16px,2.8vw,22px);cursor:pointer; touch-action: manipulation;}
    .nameBtn:disabled{opacity:.6;cursor:not-allowed}
    .tag{display:inline-block;padding:6px 10px;border-radius:999px;font-size:12px;border:1px solid rgba(0,0,0,0.18);background:rgba(255,255,255,0.5)}

    /* Number pick grid — glossy candy tiles */
    .numbers{display:grid;grid-template-columns:repeat(10, minmax(0,1fr));gap:8px}
    .num{
      aspect-ratio:1/1;border-radius:12px;border:1px solid rgba(255,255,255,0.25);
      display:flex;align-items:center;justify-content:center;
      background:
        radial-gradient(120% 120% at 30% 20%, rgba(255,255,255,0.6), rgba(255,255,255,0) 30%),
        linear-gradient(135deg,#8a5cf6,#ff7ac6);
      color:#ffffff;
      font-weight:900;cursor:pointer;user-select:none; touch-action: manipulation;
      box-shadow:0 8px 18px rgba(0,0,0,0.35), inset 0 -8px 12px rgba(0,0,0,0.25);
      text-shadow:0 2px 6px rgba(0,0,0,0.35);
    }
    .num:hover{filter:brightness(1.08)}
    .num.small{font-size:14px}
    .num.big{font-size:18px}
    .num.correct{
      background:
        radial-gradient(120% 120% at 30% 20%, rgba(255,255,255,0.7), rgba(255,255,255,0) 30%),
        linear-gradient(135deg,#34d399,#10b981);
      border-color:rgba(34,197,94,0.8);
    }
    .num.used{
      filter:saturate(0.2) brightness(0.85);
      opacity:.45;
      cursor:not-allowed;
    }

    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
    .pill{padding:8px 12px;border-radius:999px;border:1px solid rgba(255,255,255,0.18);background:#381457;color:#ffe8ff}

    .footer{margin-top:14px;display:flex;gap:10px;flex-wrap:wrap}

    /* Wrapper gets a candy-cane frame */
    .candy-frame{padding:6px;border-radius:30px;
      background:
        repeating-linear-gradient(-45deg, #ffffff 0 16px, #ff86d0 16px 32px, #ffffff 32px 48px, #8a5cf6 48px 64px);
    }
    .card-inner{border-radius:24px;background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
      border:1px solid rgba(255,255,255,0.12);padding:20px;backdrop-filter: blur(8px);}
    #errorOverlay{position:fixed;inset:0;background:rgba(0,0,0,0.8);color:#fff;display:none;align-items:center;justify-content:center;padding:24px;z-index:9999}
    #errorOverlay pre{white-space:pre-wrap;word-break:break-word;max-width:1000px}
    @media (hover:none){.num:hover{filter:none}}
  
/* Simpler, solid background for readability */
body{ background:#2b0f6b !important; }


/* Golden ticket confetti */
.confetti-piece{
  position: fixed;
  top:-12px;
  width:10px;
  height:16px;
  border-radius:2px;
  pointer-events:none;
  will-change: transform, opacity;
  animation: confetti-fall 2.6s linear forwards, confetti-spin 1.2s linear infinite;
  box-shadow: 0 2px 6px rgba(0,0,0,0.25);
}
@keyframes confetti-fall{
  0%{ transform: translate3d(var(--x,0), -10vh, 0) rotate(0deg); opacity:1; }
  100%{ transform: translate3d(var(--x,0), 110vh, 0) rotate(540deg); opacity:1; }
}
@keyframes confetti-spin{
  0%{ transform: rotateY(0deg); }
  100%{ transform: rotateY(360deg); }
}

</style>

</head>
<body>
  <div class="wrap"><div class="app candy-border"><div class="card-inner candy-frame"><div class="card-inner" id="app"></div></div></div></div>
  <div id="errorOverlay"><pre id="errorText"></pre></div>

  <script>
  // Simple error overlay to surface issues in Safari
  (function(){
    window.onerror = function(message, source, lineno, colno, error){
      const overlay = document.getElementById('errorOverlay');
      const text = document.getElementById('errorText');
      text.textContent = 'An error occurred:\n' + (message || '') + '\n' + (error && error.stack ? error.stack : '');
      overlay.style.display = 'flex';
    };
  })();

  // Polyfills for older iPad Safari
  (function(){
    if(!window.crypto){ window.crypto = {}; }
    if(!window.crypto.getRandomValues){
      window.crypto.getRandomValues = function(arr){
        for(let i=0;i<arr.length;i++){ arr[i] = Math.floor(Math.random()*256); }
        return arr;
      };
    }
    if(!window.crypto.randomUUID){
      window.crypto.randomUUID = function(){
        // RFC4122 v4 polyfill
        const bytes = new Uint8Array(16);
        window.crypto.getRandomValues(bytes);
        bytes[6] = (bytes[6] & 0x0f) | 0x40;
        bytes[8] = (bytes[8] & 0x3f) | 0x80;
        const hex = [...bytes].map(b=>('0' + b.toString(16)).slice(-2)).join('');
        return hex.slice(0,8)+'-'+hex.slice(8,12)+'-'+hex.slice(12,16)+'-'+hex.slice(16,20)+'-'+hex.slice(20);
      };
    }
  })();

  // Utility helpers
  function $(sel, el){ return (el||document).querySelector(sel); }
  function $$(sel, el){ return Array.prototype.slice.call((el||document).querySelectorAll(sel)); }

  // Core state
  var AppState = {
    phase: 'setup', // setup -> chooseCorrects -> lobby -> guess -> end
    players: [], // [{id,name,done:false,lockUntil:0}]
    numPlayers: 1,
    numCorrectTargets: 1,
    correctNumbers: new Set(), // chosen by organizer
    foundNumbers: new Set(),   // discovered by players
    activePlayerId: null,
    lockSeconds: 120
  };

  // Load/save (localStorage safe-guard)
  function save(){
    try{
      var serializable = {
        phase: AppState.phase,
        players: AppState.players,
        numPlayers: AppState.numPlayers,
        numCorrectTargets: AppState.numCorrectTargets,
        correctNumbers: Array.from(AppState.correctNumbers),
        foundNumbers: Array.from(AppState.foundNumbers),
        activePlayerId: AppState.activePlayerId,
        lockSeconds: AppState.lockSeconds
      };
      localStorage.setItem('locksolver_v1', JSON.stringify(serializable));
    }catch(e){ /* ignore quota/blocked */ }
  }
  function load(){
    try{
      var raw = localStorage.getItem('locksolver_v1');
      if(!raw) return;
      var obj = JSON.parse(raw);
      AppState.phase = obj.phase || 'setup';
      AppState.players = obj.players || [];
      AppState.numPlayers = obj.numPlayers || 1;
      AppState.numCorrectTargets = obj.numCorrectTargets || 1;
      AppState.correctNumbers = new Set(obj.correctNumbers||[]);
      AppState.foundNumbers = new Set(obj.foundNumbers||[]);
      AppState.activePlayerId = obj.activePlayerId || null;
      AppState.lockSeconds = obj.lockSeconds || 120;
    }catch(e){ /* ignore */ }
  }
  load();

  // Render switch
  function render(){
    var root = $('#app');
    root.innerHTML = '';

    var top = document.createElement('div');
    top.className = 'topbar';
    var title = document.createElement('h1');
    title.textContent = '🍭 Loompa-Like';
    var resetBtn = document.createElement('button');
    resetBtn.className = 'btn secondary';
    resetBtn.textContent = 'Reset Game';
    resetBtn.onclick = confirmReset;
    top.appendChild(title);
    top.appendChild(resetBtn);
    root.appendChild(top);

    if(AppState.phase === 'setup'){ viewSetup(root); return; }
    if(AppState.phase === 'chooseCorrects'){ viewChooseCorrects(root); return; }
    if(AppState.phase === 'lobby'){ viewLobby(root); return; }
    if(AppState.phase === 'guess'){ viewGuess(root); return; }
    if(AppState.phase === 'end'){ viewEnd(root); return; }
  }

  // Reset flow
  function confirmReset(){
    if(confirm('Reset the current game?')){
      AppState = {
        phase: 'setup',
        players: [], numPlayers: 1, numCorrectTargets: 1,
        correctNumbers: new Set(), foundNumbers: new Set(), activePlayerId: null,
        lockSeconds: 120
      };
      save();
      render();
    }
  }

  // Views
  function viewSetup(root){
    var box = document.createElement('div');
    box.className = 'row';

    var left = document.createElement('div');
    left.style.flex='1 1 320px';
    left.innerHTML = '      <h2>Setup</h2>      <div class="field">        <label>Number of Players (1–4)</label>        <select id="numPlayers">          <option>1</option><option>2</option><option>3</option><option>4</option>        </select>      </div>      <div class="field" style="margin-top:10px">        <label>Number of Correct Answers (1–4)</label>        <select id="numCorrectTargets">          <option>1</option><option>2</option><option>3</option><option>4</option>        </select>        <small class="muted">Must be ≥ number of players (each winning number can be used once).</small>      </div>';

    var right = document.createElement('div');
    right.style.flex='2 1 420px';
    right.innerHTML = '<h2>Players</h2><div class="players" id="playerInputs"></div>';

    box.appendChild(left);
    box.appendChild(right);
    root.appendChild(box);

    var numPlayersSel = $('#numPlayers');
    var numCorrectSel = $('#numCorrectTargets');
    numPlayersSel.value = AppState.numPlayers;
    numCorrectSel.value = AppState.numCorrectTargets;

    numPlayersSel.onchange = function(){ AppState.numPlayers = parseInt(numPlayersSel.value,10); buildPlayerInputs(); save(); };
    numCorrectSel.onchange = function(){ AppState.numCorrectTargets = parseInt(numCorrectSel.value,10); save(); };

    function buildPlayerInputs(){
      var wrap = $('#playerInputs');
      wrap.innerHTML = '';
      for(var i=0;i<AppState.numPlayers;i++){
        var div = document.createElement('div');
        div.className='playerBadge';
        div.innerHTML = '          <div class="field">            <label>Player '+(i+1)+' Name</label>            <input type="text" id="pname_'+i+'" placeholder="Enter name" autocomplete="off" autocapitalize="words" />          </div>';
        wrap.appendChild(div);
      }
    }
    buildPlayerInputs();

    var footer = document.createElement('div');
    footer.className = 'footer';
    var nextBtn = document.createElement('button');
    nextBtn.className = 'btn';
    nextBtn.textContent = 'Continue: Choose Correct Numbers';
    nextBtn.onclick = function(){
      if(AppState.numCorrectTargets < AppState.numPlayers){
        alert('Number of correct answers must be at least the number of players.');
        return;
      }
      var players = [];
      for(var i=0;i<AppState.numPlayers;i++){
        var inp = document.getElementById('pname_'+i);
        var name = (inp && inp.value ? inp.value : ('Player ' + (i+1))).trim();
        players.push({ id: window.crypto.randomUUID(), name: name, done:false, lockUntil:0 });
      }
      AppState.players = players;
      AppState.phase = 'chooseCorrects';
      save();
      render();
    };
    footer.appendChild(nextBtn);
    root.appendChild(footer);
  }

  function viewChooseCorrects(root){
    var info = document.createElement('div');
    info.innerHTML = '<h2>Choose '+AppState.numCorrectTargets+' Correct Number'+(AppState.numCorrectTargets>1?'s':'')+'</h2>      <p class="muted">Tap to toggle. Numbers range 1–100. These will be the only winning answers and each can be used once.</p>';
    root.appendChild(info);

    var grid = document.createElement('div');
    grid.className = 'numbers';

    for(var n=1;n<=100;n++){
      (function(n){
        var btn = document.createElement('button');
        btn.type='button';
        btn.className = 'num big';
        if(AppState.correctNumbers.has(n)) btn.classList.add('correct');
        btn.textContent = n;
        btn.onclick = function(){
          if(AppState.correctNumbers.has(n)){
            AppState.correctNumbers.delete(n);
          }else{
            if(AppState.correctNumbers.size >= AppState.numCorrectTargets){
              alert('You already picked '+AppState.numCorrectTargets+'. Tap one to unselect first.');
              return;
            }
            AppState.correctNumbers.add(n);
          }
          save();
          viewChooseCorrects(root);
        };
        grid.appendChild(btn);
      })(n);
    }

    var existing = $('.numbers', root);
    if(existing) existing.parentNode.replaceChild(grid, existing); else root.appendChild(grid);

    var footer = document.createElement('div'); footer.className='footer';
    var back = document.createElement('button'); back.className='btn secondary'; back.textContent='Back'; back.onclick=function(){AppState.phase='setup'; save(); render();};
    var start = document.createElement('button'); start.className='btn good'; start.textContent='Start Game'; start.onclick=function(){
      if(AppState.correctNumbers.size !== AppState.numCorrectTargets){
        alert('Please select exactly '+AppState.numCorrectTargets+' correct number'+(AppState.numCorrectTargets>1?'s':'')+'.');
        return;
      }
      AppState.foundNumbers = new Set();
      AppState.players = AppState.players.map(function(p){ return {id:p.id,name:p.name,done:false,lockUntil:0}; });
      AppState.phase='lobby'; save(); render();
    };
    footer.appendChild(back); footer.appendChild(start);
    var fexist = $('.footer', root); if(fexist) fexist.parentNode.replaceChild(footer,fexist); else root.appendChild(footer);
  }

  function viewLobby(root){
    var hdr = document.createElement('div');
    var remaining = AppState.players.filter(function(p){return !p.done;}).length;
    hdr.innerHTML = '<h2>Players</h2>      <p class="muted">'+remaining+' remaining to escape. Found numbers: '+(Array.from(AppState.foundNumbers).sort(function(a,b){return a-b;}).join(', ') || '—')+'</p>';
    root.appendChild(hdr);

    var grid = document.createElement('div');
    grid.className='players';

    var now = Date.now();

    AppState.players.forEach(function(p){
      var card = document.createElement('div');
      card.className='playerBadge';
      var status = document.createElement('div');
      var content = '';
      if(p.done){ content = '<span class="tag" style="border-color:rgba(34,197,94,0.5);">✅ Escaped</span>'; }
      else if(p.lockUntil && p.lockUntil>now){ var s = Math.ceil((p.lockUntil-now)/1000); content = '<span class="tag">⏳ Locked: '+s+'s</span>'; }
      else { content = '<span class="tag">Ready</span>'; }
      status.innerHTML = content;

      var b = document.createElement('button');
      b.className='nameBtn';
      b.textContent = p.name;
      b.disabled = !!(p.done || (p.lockUntil>now));
      b.onclick = function(){ AppState.activePlayerId = p.id; AppState.phase='guess'; save(); render(); };

      card.appendChild(b);
      card.appendChild(status);
      grid.appendChild(card);
    });
    root.appendChild(grid);

    if(AppState.players.every(function(p){return p.done;})){
      AppState.phase='end'; save(); render(); return;
    }

    if(!window.__lobbyTick){
      window.__lobbyTick = setInterval(function(){ if(AppState.phase==='lobby'){ render(); } }, 1000);
    }
  }

  function viewGuess(root){
    var player = AppState.players.find(function(p){return p.id===AppState.activePlayerId;});
    if(!player){ AppState.phase='lobby'; return render(); }

    var top = document.createElement('div');
    top.innerHTML = '<h2>'+player.name+': Pick a Number</h2>      <p class="muted">Choose from 1–100. Already-found correct numbers are removed for everyone.</p>';
    root.appendChild(top);

    var grid = document.createElement('div'); grid.className='numbers';

    for(var n=1;n<=100;n++){
      (function(n){
        var used = AppState.foundNumbers.has(n);
        var btn = document.createElement('button');
        btn.type='button'; btn.className='num small';
        if(used) btn.classList.add('used');
        btn.textContent = n;
        btn.disabled = used;
        btn.onclick = function(){ handleGuess(player, n); };
        grid.appendChild(btn);
      })(n);
    }
    root.appendChild(grid);

    var footer = document.createElement('div'); footer.className='footer';
    var back = document.createElement('button'); back.className='btn secondary'; back.textContent='Back to Players'; back.onclick=function(){AppState.phase='lobby'; save(); render();};
    footer.appendChild(back);
    root.appendChild(footer);
  }

  function handleGuess(player, n){
    var isCorrect = AppState.correctNumbers.has(n) && !AppState.foundNumbers.has(n);
    if(isCorrect){
      AppState.foundNumbers.add(n);
      player.done = true;
      alert(player.name+' found a correct number ( '+n+' ) and escaped! 🎉');
      launchConfettiBurst();
    }else{
      player.lockUntil = Date.now() + AppState.lockSeconds*1000;
      alert(player.name+' guessed '+n+'. Incorrect. Locked for '+AppState.lockSeconds+' seconds.');
    }
    AppState.activePlayerId = null;
    save();
    AppState.phase='lobby';
    render();
  }

  function viewEnd(root){
    var msg = document.createElement('div');
    msg.innerHTML = '<h2>🏁 All players escaped!</h2>      <p class="muted">Correct numbers were: '+(Array.from(AppState.correctNumbers).length? Array.from(AppState.correctNumbers).sort(function(a,b){return a-b;}).join(', '):'—')+'</p>';
    var again = document.createElement('button');
    again.className='btn good';
    again.textContent='Play Again';
    again.onclick = function(){ confirmReset(); };
    root.appendChild(msg);
    root.appendChild(again);
  }

  
// Launch a golden-ticket confetti burst
function launchConfettiBurst(){
  try{
    const colors = [
      'linear-gradient(180deg,#fff3bf,#f3c96b)',
      'linear-gradient(180deg,#ffe8a3,#e4b851)',
      'linear-gradient(180deg,#fdf6d0,#f1cd74)',
      'linear-gradient(180deg,#fff1bd,#ddb046)'
    ];
    const n = 120;
    for(let i=0;i<n;i++){
      const el = document.createElement('div');
      el.className = 'confetti-piece';
      const vw = Math.random()*100;       // 0..100 vw left position
      const drift = (Math.random()*40 - 20) + 'vw'; // sideways drift over fall
      el.style.left = vw + 'vw';
      el.style.setProperty('--x', drift);
      el.style.background = colors[Math.floor(Math.random()*colors.length)];
      el.style.animationDelay = (Math.random()*0.5)+'s';
      el.style.animationDuration = (2.2 + Math.random()*0.8)+'s';
      el.style.transform = 'translate3d(0,-10vh,0)';
      el.style.opacity = '0.95';
      el.addEventListener('animationend', ()=> el.remove());
      document.body.appendChild(el);
    }
  }catch(e){ /* non-fatal */ }
}

// Kick off when DOM is ready
  document.addEventListener('DOMContentLoaded', function(){ render(); });


  // Apply 'ticket' wrapper around player badges after each render
  (function(){
    const root = document.getElementById('app');
    const observer = new MutationObserver(()=>{
      document.querySelectorAll('.playerBadge').forEach(pb=>{
        if(!pb.querySelector('.ticket')){
          const inner = document.createElement('div');
          inner.className = 'ticket';
          while(pb.firstChild){ inner.appendChild(pb.firstChild); }
          pb.appendChild(inner);
        }
      });
    });
    observer.observe(root, {childList:true, subtree:true});
  })();

  </script>
</body>
</html>